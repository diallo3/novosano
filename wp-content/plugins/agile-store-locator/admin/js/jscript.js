function asl_lock(){aswal({title:"AGILE STORE LOCATOR",customClass:"asl-aswal",html:'THANK YOU FOR USING AGILE STORE LOCATOR, MANY OTHER FEATURES INCLUDING THIS ONE IS INCLUDED IN <a target="_blank" href="https://agilestorelocator.com/demos/?v=1.0.3">FULL VERSION</a>.'})}var asl_engine={};!function(t,e){"use strict";function a(e,a){var i=new google.maps.Geocoder;i.geocode({address:e},function(e,i){i==google.maps.GeocoderStatus.OK?(s.setCenter(e[0].geometry.location),a(e[0].geometry)):displayMessage("Geocode was not successful: "+i,t(".dump-message"),"alert alert-danger static",!0)})}function i(t){return null==t||("string"==typeof t&&""==t||0===Object.keys(t).length)}var s,o={is_loaded:!0,marker:null,changed:!1,store_location:null,map_marker:null,intialize:function(t){var e="";asl_configs&&asl_configs.api_key&&(e="&key="+asl_configs.api_key);var a=document.createElement("script");a.type="text/javascript",a.src="//maps.googleapis.com/maps/api/js?libraries=places,drawing&callback=asl_map_intialized"+e,document.body.appendChild(a),this.cb=t},render_a_map:function(t,e){var a=this,o=document.getElementById("map_canvas");a.store_location=t&&e?[parseFloat(t),parseFloat(e)]:[-37.815,144.965];var r=new google.maps.LatLng(a.store_location[0],a.store_location[1]);if(!o)return!1;var n={zoom:14,minZoom:8,center:r,mapTypeId:google.maps.MapTypeId.ROADMAP,styles:[{stylers:[{saturation:-100},{gamma:1}]},{elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{featureType:"poi.business",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"poi.business",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry",stylers:[{visibility:"simplified"}]},{featureType:"water",stylers:[{visibility:"on"},{saturation:50},{gamma:0},{hue:"#50a5d1"}]},{featureType:"administrative.neighborhood",elementType:"labels.text.fill",stylers:[{color:"#333333"}]},{featureType:"road.local",elementType:"labels.text",stylers:[{weight:.5},{color:"#333333"}]},{featureType:"transit.station",elementType:"labels.icon",stylers:[{gamma:1},{saturation:50}]}]};if(a.map_instance=s=new google.maps.Map(o,n),!a.store_location||i(a.store_location[0]))a.add_marker(r);else if(a.store_location){if(isNaN(a.store_location[0])||isNaN(a.store_location[1]))return;a.add_marker(r),s.panTo(r)}},add_marker:function(t){var a=this;a.map_marker=new google.maps.Marker({draggable:!0,position:t,map:s});var i=new google.maps.MarkerImage(ASL_Instance.url+"admin/images/pin1.png");i.size=new google.maps.Size(24,39),i.anchor=new google.maps.Point(24,39),a.map_marker.setIcon(i),a.map_instance.panTo(t),google.maps.event.addListener(a.map_marker,"dragend",function(){a.store_location=[a.map_marker.position.lat(),a.map_marker.position.lng()],a.changed=!0;var t=new google.maps.LatLng(a.map_marker.position.lat(),a.map_marker.position.lng());s.panTo(t),e.pages.store_changed(a.store_location)})}};e.uploader=function(e,a,i){function s(t){return"number"!=typeof t?"":t>=1e9?(t/1e9).toFixed(2)+" GB":t>=1e6?(t/1e6).toFixed(2)+" MB":(t/1e3).toFixed(2)+" KB"}var o=e.find("ul");e[0].reset(),e.fileupload({url:a,dataType:"json",done:function(t,a){o.empty(),i(t,a),e.find(".progress-bar").css("width","0%"),e.find(".progress").hide(),a.result.success},add:function(a,i){o.empty();var r=t('<li class="working"><p></p><span></span></li>');r.find("p").text(i.files[0].name.substr(0,50)).append("<i>"+s(i.files[0].size)+"</i>"),i.context=r.appendTo(o);var n=null;e.find(".btn-start").unbind().bind("click",function(){n=i.submit(),e.find(".progress").show()}),e.find(".file-name").val(i.files[0].name)},progress:function(t,a){var i=parseInt(a.loaded/a.total*100,10);e.find(".progress-bar").css("width",i+"%"),e.find(".sr-only").html(i+"%"),100==i&&a.context.removeClass("working")},fail:function(t,a){a.context.addClass("error"),e.find(".upload-status-box").html("Upload Failed! Please try again.").addClass("bg-warning alert")}}).bind("fileuploadsubmit",function(t,a){a.formData=e.serializeObject()}).prop("disabled",!t.support.fileInput).parent().addClass(t.support.fileInput?void 0:"disabled")},e.pages={store_changed:function(e){t("#asl_txt_lat").val(e[0]),t("#asl_txt_lng").val(e[1])},manage_categories:function(){var a=null,i=null;t("#tbl_categories").on("click",".glyphicon-trash",function(){i=t(this).data("id"),t("#confirm-delete").smodal("show")});var s=function(e){ServerCall(ASL_REMOTE.URL+"?action=asl_delete_category",{category_id:e},function(e){return e.success?(displayMessage(e.msg,t(".dump-message"),"alert alert-success static",!0),void a.fnDraw()):e.error?void displayMessage(e.error,t(".dump-message"),"alert alert-danger static",!0):void displayMessage("Error Occured, Please try again.",t(".dump-message"),"alert alert-danger static",!0)},"json")};t("#btn-delete-store").bind("click",function(){t("#confirm-delete").smodal("hide"),s(i)}),t("#btn-asl-new-c").bind("click",function(){t("#asl-new-cat-box").smodal("show")});a=t("#tbl_categories").dataTable({bProcessing:!0,bFilter:!1,bServerSide:!0,bAutoWidth:!0,columnDefs:[{width:"75px",targets:0},{width:"200px",targets:1},{width:"100px",targets:2},{width:"100px",targets:3},{width:"150px",targets:4},{width:"150px",targets:5},{bSortable:!1,aTargets:[5]}],iDisplayLength:10,sAjaxSource:ASL_REMOTE.URL+"?action=asl_get_categories",columns:[{data:"id"},{data:"category_name"},{data:"is_active"},{data:"icon"},{data:"created_on"},{data:"action"}],fnServerParams:function(e){t("#tbl_stores_wrapper .dataTables_scrollHead thead input").each(function(a){""!=this.value&&e.push({name:"filter["+t(this).attr("data-id")+"]",value:this.value})})},order:[[0,"desc"]]});var o=ASL_REMOTE.URL,r=t("#frm-addcategory");e.uploader(r,o+"?action=asl_add_categories",function(e,i){var i=i.result;i.success?(t("#message_upload").text(i.message),t("#asl-new-cat-box").smodal("hide"),t("#frm-addcategory").find("input:text, input:file").val(""),t("#message_upload").empty().addClass("hide"),t("#progress_bar").hide(),a.fnDraw()):t("#message_upload").html(i.message).removeClass("hide")}),t("#tbl_categories tbody").on("click",".edit_category",function(e){t("#updatecategory_image").show(),t("#updatecategory_editimage").hide(),t("#confirm-update").smodal("show"),t("#update_category_id").text(t(this).attr("data-id")),t("#update_category_id_input").val(t(this).attr("data-id")),t("#message_update").text(""),ServerCall(ASL_REMOTE.URL+"?action=asl_get_category_byid",{category_id:t(this).attr("data-id")},function(e){return e.success?(t("#update_category_name").val(e.list[0].category_name),void t("#update_category_icon").attr("src",ASL_Instance.url+"public/icon/"+e.list[0].icon)):void t("#message_update").text(e.error)},"json")}),t("#change_image").click(function(){t("#update_category_icon").attr("data-id",""),t("#updatecategory_image").hide(),t("#message_update").text(""),t("#updatecategory_editimage").show()}),t("#btn-asl-update-categories").click(function(){"same"==t("#update_category_icon").attr("data-id")&&ServerCall(ASL_REMOTE.URL+"?action=asl_update_category",{data:{category_id:t("#update_category_id").text(),action:"same",category_name:t("#update_category_name").val()}},function(e){return e.success?(t("#message_update").text(e.msg),void a.fnDraw()):e.error?void t("#message_update").text(e.msg):void 0},"json")});var o=ASL_REMOTE.URL,r=t("#frm-updatecategory");r.append('<input type="hidden" name="data[action]" value="notsame" /> '),e.uploader(r,o+"?action=asl_update_category",function(e,i){var i=i.result;i.success?(t("#message_update").text(i.msg),t("#confirm-update").smodal("hide"),t("#frm-updatecategory").find("input:text, input:file").val(""),t("#progress_bar_").hide(),a.fnDraw()):t("#message_update").text(i.error)}),t("#tbl_categories tbody").on("click",".delete_category",function(e){t("#confirm-delete").smodal("show"),t("#delete_category_id").text(t(this).attr("data-id"))}),t("#btn-delete-category").click(function(){ServerCall(ASL_REMOTE.URL+"?action=asl_delete_category",{category_id:t("#delete_category_id").text()},function(e){return e.success?(t("#message_upload").text(e.msg),a.fnDraw(),void t("#confirm-delete").smodal("hide")):e.error?void t("#message_upload").text(e.msg):void 0},"json")}),t("thead input").keyup(function(t){13==t.keyCode&&a.fnDraw()})},manage_stores:function(){var e=null,a=null,i=null,s=function(){var a=t("#asl-delete-stores");a.bootButton("loading"),ServerCall(ASL_REMOTE.URL+"?action=asl_delete_all_stores",{},function(i){a.bootButton("reset"),displayMessage(i.msg,t(".dump-message"),"alert alert-success static",i.success),e.fnDraw()},"json")};t("#asl-delete-stores").bind("click",function(t){aswal({title:"Delete Stores",text:"Are you sure you want to delete ALL STORES?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Delete it!"}).then(function(){s()})}),t("#tbl_stores").on("click",".glyphicon-duplicate",function(){i=t(this).data("id"),aswal({title:"Duplicate Stores",text:"Are you sure you want to Duplicate Selected Store?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Duplicate it!"}).then(function(){r(i)})}),t("#tbl_stores").on("click",".glyphicon-trash",function(){a=t(this).data("id"),t("#confirm-delete").smodal("show")});var o=function(a){ServerCall(ASL_REMOTE.URL+"?action=asl_delete_store",{store_id:a},function(a){return a.success?(displayMessage(a.msg,t(".dump-message"),"alert alert-success static",!0),void e.fnDraw()):a.error?void displayMessage(a.error,t(".dump-message"),"alert alert-danger static",!0):void displayMessage("Error Occured, Please try again.",t(".dump-message"),"alert alert-danger static",!0)},"json")},r=function(a){ServerCall(ASL_REMOTE.URL+"?action=asl_duplicate_store",{store_id:a},function(a){return a.success?(displayMessage(a.msg,t(".dump-message"),"alert alert-success static",!0),void e.fnDraw()):a.error?void displayMessage(a.error,t(".dump-message"),"alert alert-danger static",!0):void displayMessage("Error Occured, Please try again.",t(".dump-message"),"alert alert-danger static",!0)},"json")};t("#btn-delete-store").bind("click",function(){t("#confirm-delete").smodal("hide"),o(a)}),t("#btn-duplicate-store").bind("click",function(){t("#confirm-duplicate").smodal("hide"),r(i)});e=t("#tbl_stores").dataTable({bProcessing:!0,bFilter:!1,bServerSide:!0,scrollX:!0,bAutoWidth:!0,columnDefs:[{width:"250px",targets:0},{width:"75px",targets:1},{width:"200px",targets:2},{width:"300px",targets:3},{width:"300px",targets:4},{width:"300px",targets:5},{width:"300px",targets:6},{width:"150px",targets:7},{width:"150px",targets:8},{width:"150px",targets:9},{width:"150px",targets:10},{width:"150px",targets:11},{width:"150px",targets:12},{width:"50px",targets:13},{width:"350px",targets:14},{width:"50px",targets:15},{width:"50px",targets:16},{width:"150px",targets:17},{bSortable:!1,aTargets:[14,0]}],iDisplayLength:10,sAjaxSource:ASL_REMOTE.URL+"?action=asl_get_store_list",columns:[{data:"action"},{data:"id"},{data:"title"},{data:"description"},{data:"lat"},{data:"lng"},{data:"street"},{data:"state"},{data:"city"},{data:"phone"},{data:"email"},{data:"website"},{data:"postal_code"},{data:"is_disabled"},{data:"categories"},{data:"marker_id"},{data:"logo_id"},{data:"created_on"}],fnServerParams:function(e){t("#tbl_stores_wrapper .dataTables_scrollHead thead input").each(function(a){""!=this.value&&e.push({name:"filter["+t(this).attr("data-id")+"]",value:this.value})})},order:[[0,"desc"]]}),t("thead input").keyup(function(t){13==t.keyCode&&e.fnDraw()}),t("#Search_Data").click(function(){e.fnDraw()})},customize_map:function(){t(".asl-p-cont .map-option-bottom #asl-trafic_layer").bind("click",function(t){asl_lock()}),t(".asl-p-cont .map-option-bottom #asl-transit_layer").bind("click",function(t){asl_lock()}),t(".asl-p-cont .map-option-bottom #asl-bike_layer").bind("click",function(t){asl_lock()}),t(".asl-p-cont .map-option-bottom #asl-marker_animations").bind("click",function(t){asl_lock()}),t("#asl-save-map").bind("click",function(t){asl_lock()})},edit_store:function(t){this.add_store(!0,t)},add_store:function(r,n){function l(e){var a=t.trim(e).toUpperCase(),i=/(1[012]|[1-9]):[0-5][0-9][ ]?(AM|PM)/;if(!i.test(a))return 0;var s=Number(a.match(/^(\d+)/)[1]),o=Number(a.match(/:(\d+)/)[1]),r=a.indexOf("PM")!=-1?"PM":"AM";return"PM"==r&&s<12&&(s+=12),"AM"==r&&12==s&&(s-=12),s+o/100}function d(){var e={};return t(".asl-time-details .asl-all-day-times").each(function(a){var i=t(this),s=String(i.data("day"));e[s]=null,i.find(".form-group").length>0?e[s]=[]:e[s]=i.find(".asl-closed-lbl input")[0].checked?"1":"0",i.find(".form-group").each(function(){var a=t(this).find("input");e[s].push(a.eq(0).val()+" - "+a.eq(1).val())})}),JSON.stringify(e)}var c=t("#frm-addstore"),p=new Date;p.setHours(7),p.setMinutes(0);var u=p.toLocaleTimeString(navigator.language,{hour:"2-digit",minute:"2-digit"});p.setHours(p.getHours()+12);var g=p.toLocaleTimeString(navigator.language,{hour:"2-digit",minute:"2-digit"});t(".start_time").timepicker({defaultTime:n?null:u,appendWidgetTo:".asl-p-cont"}),t(".end_time").timepicker({defaultTime:n?null:g,appendWidgetTo:".asl-p-cont"});var m=new Date;t(".asl-time-details tbody").on("click",".add-k-add",function(e){var a=t('<div class="form-group">\t\t\t\t\t\t\t\t\t\t<div class="input-append input-group bootstrap-timepicker">\t\t\t\t\t\t\t\t          <input type="text" value="9:30 AM" class="form-control timepicker validate[required,funcCall[ASLmatchTime]]" placeholder="Start Time">\t\t\t\t\t\t\t\t          <span class="input-group-addon add-on"><i class="glyphicon glyphicon-time icon-time"></i></span>\t\t\t\t\t\t\t\t        </div>\t\t\t\t\t\t\t\t        <div class="input-append input-group bootstrap-timepicker">\t\t\t\t\t\t\t\t          <input type="text" value="6:30 PM" class="form-control timepicker validate[required]" placeholder="End Time">\t\t\t\t\t\t\t\t          <span class="input-group-addon add-on"><i class="glyphicon glyphicon-time icon-time"></i></span>\t\t\t\t\t\t\t\t        </div>\t\t\t\t\t\t\t\t        <span class="add-k-delete glyphicon glyphicon-trash"></span>\t\t\t\t\t\t\t\t    </div>'),i=t(this).parent().prev().find(".asl-all-day-times .asl-closed-lbl");i.before(a),a.find("input.timepicker").removeAttr("id").attr("class","form-control timepicker validate[required]").val("").timepicker({defaultTime:m,appendWidgetTo:".asl-p-cont"})}),t(".asl-time-details tbody").on("click",".glyphicon-trash",function(e){t(this).parent().remove()}),t(".asl-p-cont .asl-time-details .timepicker").timepicker({appendWidgetTo:".asl-p-cont"}),window.ASLmatchTime=function(t,e,a,i){var s=t.parent().next().children(0),o=l(t.val()),r=l(s.val());if(o>=r)return"* Invalid"},t(function(){window.google&&google.maps?asl_map_intialized():o.intialize()}),window.asl_map_intialized=function(){n?o.render_a_map(n.lat,n.lng):o.render_a_map()},t("#ddl_categories").chosen({width:"100%"}),c.validationEngine({binded:!0,scroll:!1}),t("#txt_city,#txt_state,#txt_postal_code").bind("blur",function(t){if(!i(c[0].elements["data[city]"].value)&&!i(c[0].elements["data[postal_code]"].value)){for(var r=[c[0].elements["data[street]"].value,c[0].elements["data[city]"].value,c[0].elements["data[postal_code]"].value,c[0].elements["data[state]"].value],n=[],l=0;l<r.length;l++)r[l]&&n.push(r[l]);var d=jQuery("#txt_country option:selected").text();d&&"Select Country"!=d&&n.push(d),r=n.join(", "),a(r,function(t){var a=[t.location.lat(),t.location.lng()];new google.maps.LatLng(a[0],a[1]);o.map_marker.setPosition(t.location),s.panTo(t.location),e.pages.store_changed(a)})}});var _={lat:"",lng:""};t("#lnk-edit-coord").bind("click",function(e){_.lat=t("#asl_txt_lat").val(),_.lng=t("#asl_txt_lng").val(),t("#asl_txt_lat,#asl_txt_lng").val("").removeAttr("readonly")});var f=t("#asl_txt_lat,#asl_txt_lng");f.bind("change",function(e){if(f[0].value&&f[1].value&&!isNaN(f[0].value)&&!isNaN(f[1].value)){var a=new google.maps.LatLng(parseFloat(t("#asl_txt_lat").val()),parseFloat(t("#asl_txt_lng").val()));o.map_marker.setPosition(a),s.panTo(a)}}),t("#btn-asl-add").bind("click",function(e){if(c.validationEngine("validate")){var a=t(this),i=c.serializeObject();i.action=r?"asl_edit_store":"asl_add_store",i.category=t("#ddl_categories").val(),r&&(i.updateid=t("#update_id").val()),i["data[marker_id]"]="1",i["data[logo_id]"]="1",i["data[open_hours]"]=d(),a.bootButton("loading"),ServerCall(ASL_REMOTE.URL,i,function(e){return a.bootButton("reset"),e.success?(c[0].reset(),a.bootButton("completed"),r&&(e.msg+=" Redirect...",window.location.replace(ASL_REMOTE.URL.replace("-ajax","")+"?page=manage-agile-store")),void displayMessage(e.msg,t(".dump-message"),"alert alert-success static",!0)):e.error?void displayMessage(e.error,t(".dump-message"),"alert alert-danger static",!0):void displayMessage("Error Occured, Please try again.",t(".dump-message"),"alert alert-danger static",!0)},"json")}})},user_setting:function(e){var a=t("#frm-usersetting"),i=Object.keys(e);for(var s in i){var o=a.find("#asl-"+i[s]);o.val(e[i[s]])}t("#btn-asl-user_setting").bind("click",function(e){if(a.validationEngine("validate")){var i={},s=a.serializeObject();i=t.extend(i,s),ServerCall(ASL_REMOTE.URL+"?action=asl_save_setting",i,function(e){return e.success?void displayMessage(e.msg,t(".dump-message"),"alert alert-success static",!0):e.error?void displayMessage(e.msg,t(".dump-message"),"alert alert-danger static",!0):void displayMessage("Error Occurred.",t(".dump-message"),"alert alert-danger static",!0)},"json")}})}},t&&t(".asl-p-cont").append('<div class="loading site hide">Working ...</div><div class="asl-dumper dump-message"></div>')}(jQuery,asl_engine);